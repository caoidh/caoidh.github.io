<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Диаграмма микросервисной архитектуры "SmartLearn"</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f8f9fa;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: #333;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
            border: 1px solid #dee2e6;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 20px;
        }
        h1 {
            text-align: center;
            color: #0056b3;
            margin-bottom: 20px;
            font-size: 24px;
        }
        svg {
            width: 100%;
            height: auto;
        }

        /* Стили элементов */
        .client-box { fill: #e9f5ff; stroke: #007bff; }
        .gateway-box { fill: #fff3cd; stroke: #ffc107; }
        .service-box { fill: #d4edda; stroke: #28a745; }
        .ai-service-box { fill: #d1e7dd; stroke: #198754; }
        .db-box { fill: #f8d7da; stroke: #dc3545; }
        .text-label { font-size: 13px; font-weight: 500; text-anchor: middle; dominant-baseline: central; }
        .text-small { font-size: 11px; text-anchor: middle; dominant-baseline: central; }

        .arrow-line { stroke: #6c757d; stroke-width: 2; }
        .flow-arrow { stroke: #0056b3; stroke-width: 2.5; }
        .async-arrow { stroke: #fd7e14; stroke-width: 2.5; stroke-dasharray: 5, 5; }

        .legend-rect { stroke: #ccc; stroke-width: 1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Высокоуровневая модель платформы "SmartLearn"</h1>
        <svg viewBox="0 0 1200 750" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#6c757d" />
                </marker>
                <marker id="flow-arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#0056b3" />
                </marker>
                <marker id="async-arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#fd7e14" />
                </marker>
            </defs>
            
            <text x="600" y="105" font-size="18" font-weight="bold" text-anchor="middle">
                Пример потока запроса: Запись на платный курс
            </text>
            
            <!-- Клиент и Gateway -->
            <rect x="525" y="20" width="150" height="50" rx="10" class="client-box"/>
            <text x="600" y="45" class="text-label">Клиент</text>
            <text x="600" y="60" class="text-small">(Веб / Мобильное приложение)</text>

            <!-- Текст потока запроса перенесён под клиента -->

            <rect x="525" y="140" width="150" height="50" rx="10" class="gateway-box"/>
            <text x="600" y="165" class="text-label">API Gateway</text>

            <!-- Микросервисы -->
            <g id="microservices">
                <rect x="50" y="270" width="140" height="50" rx="10" class="service-box"/>
                <text x="120" y="295" class="text-label">Сервис</text>
                <text x="120" y="310" class="text-small">пользователей</text>

                <rect x="230" y="270" width="140" height="50" rx="10" class="service-box"/>
                <text x="300" y="295" class="text-label">Сервис курсов</text>

                <rect x="430" y="270" width="140" height="50" rx="10" class="service-box"/>
                <text x="500" y="295" class="text-label">Сервис записи</text>
                <text x="500" y="310" class="text-small">на курсы</text>

                <rect x="630" y="270" width="140" height="50" rx="10" class="service-box"/>
                <text x="700" y="295" class="text-label">Платежный</text>
                <text x="700" y="310" class="text-small">сервис</text>

                <rect x="810" y="270" width="140" height="50" rx="10" class="service-box"/>
                <text x="880" y="295" class="text-label">Сервис</text>
                <text x="880" y="310" class="text-small">потоковой передачи</text>

                <rect x="990" y="270" width="140" height="50" rx="10" class="ai-service-box"/>
                <text x="1060" y="295" class="text-label">Сервис</text>
                <text x="1060" y="310" class="text-small">AI контента</text>
            </g>

            <!-- Базы данных -->
            <g id="databases">
                <rect x="50" y="370" width="140" height="40" rx="10" class="db-box"/>
                <text x="120" y="395" class="text-label">БД Пользователей</text>

                <rect x="230" y="370" width="140" height="40" rx="10" class="db-box"/>
                <text x="300" y="395" class="text-label">БД Курсов</text>

                <rect x="430" y="370" width="140" height="40" rx="10" class="db-box"/>
                <text x="500" y="395" class="text-label">БД Записей</text>

                <rect x="630" y="370" width="140" height="40" rx="10" class="db-box"/>
                <text x="700" y="395" class="text-label">БД Платежей</text>

                <rect x="810" y="370" width="140" height="40" rx="10" class="db-box"/>
                <text x="880" y="395" class="text-label">БД Видео</text>

                <rect x="990" y="370" width="140" height="40" rx="10" class="db-box"/>
                <text x="1060" y="395" class="text-label">БД AI Данных</text>
            </g>

            <!-- Связи -->
            <line x1="600" y1="70" x2="600" y2="130" class="arrow-line" marker-end="url(#arrowhead)"/>
            <path d="M600 190 Q 500 220, 120 260" stroke="#6c757d" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M600 190 Q 500 220, 300 260" stroke="#6c757d" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M600 190 Q 550 220, 500 260" stroke="#6c757d" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M600 190 Q 650 220, 700 260" stroke="#6c757d" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M600 190 Q 700 220, 880 260" stroke="#6c757d" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
            <path d="M600 190 Q 800 220, 1060 260" stroke="#6c757d" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

            <!-- Сервисы к БД -->
            <line x1="120" y1="320" x2="120" y2="365" class="arrow-line" marker-end="url(#arrowhead)"/>
            <line x1="300" y1="320" x2="300" y2="365" class="arrow-line" marker-end="url(#arrowhead)"/>
            <line x1="500" y1="320" x2="500" y2="365" class="arrow-line" marker-end="url(#arrowhead)"/>
            <line x1="700" y1="320" x2="700" y2="365" class="arrow-line" marker-end="url(#arrowhead)"/>
            <line x1="880" y1="320" x2="880" y2="365" class="arrow-line" marker-end="url(#arrowhead)"/>
            <line x1="1060" y1="320" x2="1060" y2="365" class="arrow-line" marker-end="url(#arrowhead)"/>

            <!-- Поток запроса -->
            <g id="request-flow">
                <line x1="600" y1="70" x2="600" y2="130" class="flow-arrow" marker-end="url(#flow-arrowhead)"/>
                <text x="620" y="100" fill="#0056b3" font-weight="bold">1</text>

                <path d="M600 190 Q 550 220, 500 260" class="flow-arrow" fill="none" marker-end="url(#flow-arrowhead)"/>
                <text x="540" y="205" fill="#0056b3" font-weight="bold">2</text>

                <path d="M430 295 Q 380 245, 370 295" stroke="#0056b3" stroke-width="2.5" fill="none" marker-end="url(#flow-arrowhead)"/>
                <text x="395" y="250" fill="#0056b3" font-weight="bold">3</text>

                <path d="M570 295 Q 615 245, 630 295" stroke="#0056b3" stroke-width="2.5" fill="none" marker-end="url(#flow-arrowhead)"/>
                <text x="600" y="250" fill="#0056b3" font-weight="bold">4</text>

                <path d="M630 295 Q 585 345, 570 295" class="async-arrow" fill="none" marker-end="url(#async-arrowhead)"/>
                <text x="600" y="330" fill="#fd7e14" font-weight="bold">5</text>
            </g>

            <!-- Легенда в две колонки -->
<g id="legend" transform="translate(375, 550)">
    <rect x="0" y="0" width="450" height="160" rx="10" fill="#f8f9fa" class="legend-rect"/>
    <text x="225" y="25" font-size="16" font-weight="bold" text-anchor="middle">Обозначение</text>

    <!-- Левая колонка -->
    <rect x="30" y="50" width="20" height="20" class="client-box"/>
    <text x="70" y="65">Клиентское приложение</text>

    <rect x="30" y="80" width="20" height="20" class="gateway-box"/>
    <text x="70" y="95">API Gateway</text>

    <rect x="30" y="110" width="20" height="20" class="service-box"/>
    <text x="70" y="125">Микросервис</text>

    <!-- Правая колонка -->
    <rect x="250" y="50" width="20" height="20" class="ai-service-box"/>
    <text x="290" y="65">AI Микросервис</text>

    <rect x="250" y="80" width="20" height="20" class="db-box"/>
    <text x="290" y="95">База данных</text>

    <line x1="250" y1="115" x2="275" y2="115" class="flow-arrow" marker-end="url(#flow-arrowhead)"/>
    <text x="295" y="120">Синхронный запрос</text>

    <line x1="250" y1="140" x2="275" y2="140" class="async-arrow" marker-end="url(#async-arrowhead)"/>
    <text x="295" y="145">Асинхронное сообщение</text>
</g>
        </svg>
    </div>
</body>
</html>
